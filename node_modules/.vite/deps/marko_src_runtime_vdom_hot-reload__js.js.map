{
  "version": 3,
  "sources": ["../../marko/src/runtime/vdom/hot-reload.js"],
  "sourcesContent": ["var runtime = require(\".\");\nvar queueMicrotask = require(\"../queueMicrotask\");\nvar util = require(\"../components/util\");\nvar registry = require(\"../components/registry\");\nvar updateManager = require(\"../components/update-manager\");\n\nvar createTemplate = runtime.t;\nvar createComponent = registry.___createComponent;\nvar registered = {};\nvar queue;\n\nruntime.t = function (typeName) {\n  if (registered[typeName]) {\n    return registered[typeName];\n  }\n\n  var renderFn;\n  var template = (registered[typeName] = createTemplate(typeName));\n  var instances = (template.___instances = []);\n  Object.defineProperty(template, \"_\", {\n    get: function () {\n      return renderFn && proxyRenderer;\n    },\n    set: function (v) {\n      renderFn = v;\n\n      if (instances.length) {\n        if (!queue) {\n          queue = [];\n          queueMicrotask(batchUpdate);\n        }\n\n        queue.push(function () {\n          var newProto = registry.___getComponentClass(typeName).prototype;\n          instances.forEach(function (instance) {\n            if (hasLifecycleChanged(instance.__proto__, newProto)) {\n              var startNode = instance.___rootNode.startNode;\n              var endNode = instance.___rootNode.endNode;\n              var parentNode = startNode.parentNode;\n              var curNode;\n\n              instance.___hmrDestroyed = true;\n              instance.___emitDestroy();\n              instance.___removeDOMEventListeners();\n\n              if (instance.___subscriptions) {\n                instance.___subscriptions.removeAllListeners();\n                instance.___subscriptions = null;\n              }\n\n              while ((curNode = startNode.nextSibling) !== endNode) {\n                util.___destroyNodeRecursive(curNode);\n                parentNode.removeChild(curNode);\n              }\n\n              instance.___hmrDestroyed = false;\n              instance.___mounted = false;\n            }\n\n            instance.__proto__ = newProto;\n            instance\n              .___rerender(instance.___input, false)\n              .afterInsert(instance.___host);\n          });\n        });\n      }\n    }\n  });\n\n  return template;\n\n  function proxyRenderer() {\n    return renderFn.apply(this, arguments);\n  }\n};\n\nregistry.___createComponent = function (typeName, id) {\n  var template = registered[typeName];\n  var instance = createComponent(typeName, id);\n\n  if (template) {\n    var instances = template.___instances;\n    instances.push(instance);\n    instance.once(\"destroy\", function () {\n      if (!instance.___hmrDestroyed) {\n        instances.splice(1, instances.indexOf(instance));\n      }\n    });\n  }\n\n  return instance;\n};\n\nfunction hasLifecycleChanged(oldProto, newProto) {\n  return (\n    hasMethodChanged(\"onCreate\") ||\n    hasMethodChanged(\"onInput\") ||\n    hasMethodChanged(\"onRender\") ||\n    hasMethodChanged(\"onMount\")\n  );\n\n  function hasMethodChanged(method) {\n    return (\n      (oldProto[method] && oldProto[method].toString()) !==\n      (newProto[method] && newProto[method].toString())\n    );\n  }\n}\n\nfunction batchUpdate() {\n  updateManager.___batchUpdate(function () {\n    var pending = queue;\n    queue = undefined;\n\n    for (var i = 0; i < pending.length; i++) {\n      pending[i]();\n    }\n  });\n}\n\nmodule.exports = runtime;\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA,QAAI,UAAU;AACd,QAAI,iBAAiB;AACrB,QAAI,OAAO;AACX,QAAI,WAAW;AACf,QAAI,gBAAgB;AAEpB,QAAI,iBAAiB,QAAQ;AAC7B,QAAI,kBAAkB,SAAS;AAC/B,QAAI,aAAa,CAAC;AAClB,QAAI;AAEJ,YAAQ,IAAI,SAAU,UAAU;AAC9B,UAAI,WAAW,WAAW;AACxB,eAAO,WAAW;AAAA,MACpB;AAEA,UAAI;AACJ,UAAI,WAAY,WAAW,YAAY,eAAe,QAAQ;AAC9D,UAAI,YAAa,SAAS,eAAe,CAAC;AAC1C,aAAO,eAAe,UAAU,KAAK;AAAA,QACnC,KAAK,WAAY;AACf,iBAAO,YAAY;AAAA,QACrB;AAAA,QACA,KAAK,SAAU,GAAG;AAChB,qBAAW;AAEX,cAAI,UAAU,QAAQ;AACpB,gBAAI,CAAC,OAAO;AACV,sBAAQ,CAAC;AACT,6BAAe,WAAW;AAAA,YAC5B;AAEA,kBAAM,KAAK,WAAY;AACrB,kBAAI,WAAW,SAAS,qBAAqB,QAAQ,EAAE;AACvD,wBAAU,QAAQ,SAAU,UAAU;AACpC,oBAAI,oBAAoB,SAAS,WAAW,QAAQ,GAAG;AACrD,sBAAI,YAAY,SAAS,YAAY;AACrC,sBAAI,UAAU,SAAS,YAAY;AACnC,sBAAI,aAAa,UAAU;AAC3B,sBAAI;AAEJ,2BAAS,kBAAkB;AAC3B,2BAAS,eAAe;AACxB,2BAAS,2BAA2B;AAEpC,sBAAI,SAAS,kBAAkB;AAC7B,6BAAS,iBAAiB,mBAAmB;AAC7C,6BAAS,mBAAmB;AAAA,kBAC9B;AAEA,0BAAQ,UAAU,UAAU,iBAAiB,SAAS;AACpD,yBAAK,wBAAwB,OAAO;AACpC,+BAAW,YAAY,OAAO;AAAA,kBAChC;AAEA,2BAAS,kBAAkB;AAC3B,2BAAS,aAAa;AAAA,gBACxB;AAEA,yBAAS,YAAY;AACrB,yBACG,YAAY,SAAS,UAAU,KAAK,EACpC,YAAY,SAAS,OAAO;AAAA,cACjC,CAAC;AAAA,YACH,CAAC;AAAA,UACH;AAAA,QACF;AAAA,MACF,CAAC;AAED,aAAO;AAEP,eAAS,gBAAgB;AACvB,eAAO,SAAS,MAAM,MAAM,SAAS;AAAA,MACvC;AAAA,IACF;AAEA,aAAS,qBAAqB,SAAU,UAAU,IAAI;AACpD,UAAI,WAAW,WAAW;AAC1B,UAAI,WAAW,gBAAgB,UAAU,EAAE;AAE3C,UAAI,UAAU;AACZ,YAAI,YAAY,SAAS;AACzB,kBAAU,KAAK,QAAQ;AACvB,iBAAS,KAAK,WAAW,WAAY;AACnC,cAAI,CAAC,SAAS,iBAAiB;AAC7B,sBAAU,OAAO,GAAG,UAAU,QAAQ,QAAQ,CAAC;AAAA,UACjD;AAAA,QACF,CAAC;AAAA,MACH;AAEA,aAAO;AAAA,IACT;AAEA,aAAS,oBAAoB,UAAU,UAAU;AAC/C,aACE,iBAAiB,UAAU,KAC3B,iBAAiB,SAAS,KAC1B,iBAAiB,UAAU,KAC3B,iBAAiB,SAAS;AAG5B,eAAS,iBAAiB,QAAQ;AAChC,gBACG,SAAS,WAAW,SAAS,QAAQ,SAAS,QAC9C,SAAS,WAAW,SAAS,QAAQ,SAAS;AAAA,MAEnD;AAAA,IACF;AAEA,aAAS,cAAc;AACrB,oBAAc,eAAe,WAAY;AACvC,YAAI,UAAU;AACd,gBAAQ;AAER,iBAAS,IAAI,GAAG,IAAI,QAAQ,QAAQ,KAAK;AACvC,kBAAQ,GAAG;AAAA,QACb;AAAA,MACF,CAAC;AAAA,IACH;AAEA,WAAO,UAAU;AAAA;AAAA;",
  "names": []
}
