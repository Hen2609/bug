{
  "version": 3,
  "sources": ["../../marko/src/core-tags/core/await/reorderer-renderer.js"],
  "sourcesContent": ["\"use strict\";\n\nvar escapeDoubleQuotes =\n  require(\"../../../runtime/html/helpers/escape-quotes\").___escapeDoubleQuotes;\n\nmodule.exports = function (input, out) {\n  // We cannot call beginSync() when using renderSync(). In this case we will\n  // ignore the await-reorderer tag.\n  if (out.isSync()) {\n    return;\n  }\n\n  var global = out.global;\n\n  // We have already invoked an <await-reorderer>. We do not need to do this\n  // work again.\n  if (global.__awaitReordererInvoked) {\n    return;\n  }\n\n  global.__awaitReordererInvoked = true;\n\n  if (out.global.___clientReorderContext) {\n    out.flush();\n  }\n\n  var asyncOut = out.beginAsync({\n    last: true,\n    timeout: -1,\n    name: \"await-reorderer\"\n  });\n\n  out.onLast(function (next) {\n    var awaitContext = global.___clientReorderContext;\n    var remaining;\n\n    // Validate that we have remaining <await> instances that need handled\n    if (\n      !awaitContext ||\n      !awaitContext.instances ||\n      !(remaining = awaitContext.instances.length)\n    ) {\n      asyncOut.end();\n      next();\n      return;\n    }\n\n    function handleAwait(awaitInfo) {\n      awaitInfo.out\n        .on(\"___toString\", out.emit.bind(out, \"___toString\"))\n        .on(\"finish\", function (result) {\n          if (!global._afRuntime) {\n            // Minified version of ./client-reorder-runtime.js\n            asyncOut.script(\n              `function $af(d,a,e,l,g,h,k,b,f,c){c=$af;if(a&&!c[a])(c[a+=\"$\"]||(c[a]=[])).push(d);else{e=document;l=e.getElementById(\"af\"+d);g=e.getElementById(\"afph\"+d);h=e.createDocumentFragment();k=l.childNodes;b=0;for(f=k.length;b<f;b++)h.appendChild(k.item(0));g&&g.parentNode.replaceChild(h,g);c[d]=1;if(a=c[d+\"$\"])for(b=0,f=a.length;b<f;b++)c(a[b])}}`\n            );\n            global._afRuntime = true;\n          }\n\n          if (global.cspNonce) {\n            asyncOut.write(\n              '<style nonce=\"' +\n                escapeDoubleQuotes(global.cspNonce) +\n                '\">' +\n                \"#af\" +\n                awaitInfo.id +\n                \"{display:none;}\" +\n                \"</style>\" +\n                '<div id=\"af' +\n                awaitInfo.id +\n                '\">' +\n                result.toString() +\n                \"</div>\"\n            );\n          } else {\n            asyncOut.write(\n              '<div id=\"af' +\n                awaitInfo.id +\n                '\" style=\"display:none\">' +\n                result.toString() +\n                \"</div>\"\n            );\n          }\n\n          asyncOut.script(\n            \"$af(\" +\n              (typeof awaitInfo.id === \"number\"\n                ? awaitInfo.id\n                : '\"' + awaitInfo.id + '\"') +\n              (awaitInfo.after ? ',\"' + awaitInfo.after + '\"' : \"\") +\n              \")\"\n          );\n\n          awaitInfo.out.writer = asyncOut.writer;\n\n          out.emit(\"await:finish\", awaitInfo);\n\n          out.flush();\n\n          if (--remaining === 0) {\n            asyncOut.end();\n            next();\n          }\n        })\n        .on(\"error\", function (err) {\n          asyncOut.error(err);\n        });\n    }\n\n    awaitContext.instances.forEach(handleAwait);\n\n    out.on(\"await:clientReorder\", function (awaitInfo) {\n      remaining++;\n      handleAwait(awaitInfo);\n    });\n\n    // Now that we have a listener attached, we want to receive any additional\n    // out-of-sync instances via an event\n    delete awaitContext.instances;\n  });\n};\n"],
  "mappings": ";;;;;;;;AAAA;AAAA;AAEA,QAAI,qBACF,wBAAuD;AAEzD,WAAO,UAAU,SAAU,OAAO,KAAK;AAGrC,UAAI,IAAI,OAAO,GAAG;AAChB;AAAA,MACF;AAEA,UAAI,SAAS,IAAI;AAIjB,UAAI,OAAO,yBAAyB;AAClC;AAAA,MACF;AAEA,aAAO,0BAA0B;AAEjC,UAAI,IAAI,OAAO,yBAAyB;AACtC,YAAI,MAAM;AAAA,MACZ;AAEA,UAAI,WAAW,IAAI,WAAW;AAAA,QAC5B,MAAM;AAAA,QACN,SAAS;AAAA,QACT,MAAM;AAAA,MACR,CAAC;AAED,UAAI,OAAO,SAAU,MAAM;AACzB,YAAI,eAAe,OAAO;AAC1B,YAAI;AAGJ,YACE,CAAC,gBACD,CAAC,aAAa,aACd,EAAE,YAAY,aAAa,UAAU,SACrC;AACA,mBAAS,IAAI;AACb,eAAK;AACL;AAAA,QACF;AAEA,iBAAS,YAAY,WAAW;AAC9B,oBAAU,IACP,GAAG,eAAe,IAAI,KAAK,KAAK,KAAK,aAAa,CAAC,EACnD,GAAG,UAAU,SAAU,QAAQ;AAC9B,gBAAI,CAAC,OAAO,YAAY;AAEtB,uBAAS;AAAA,gBACP;AAAA,cACF;AACA,qBAAO,aAAa;AAAA,YACtB;AAEA,gBAAI,OAAO,UAAU;AACnB,uBAAS;AAAA,gBACP,mBACE,mBAAmB,OAAO,QAAQ,IAClC,UAEA,UAAU,KACV,uCAGA,UAAU,KACV,OACA,OAAO,SAAS,IAChB;AAAA,cACJ;AAAA,YACF,OAAO;AACL,uBAAS;AAAA,gBACP,gBACE,UAAU,KACV,4BACA,OAAO,SAAS,IAChB;AAAA,cACJ;AAAA,YACF;AAEA,qBAAS;AAAA,cACP,UACG,OAAO,UAAU,OAAO,WACrB,UAAU,KACV,MAAM,UAAU,KAAK,QACxB,UAAU,QAAQ,OAAO,UAAU,QAAQ,MAAM,MAClD;AAAA,YACJ;AAEA,sBAAU,IAAI,SAAS,SAAS;AAEhC,gBAAI,KAAK,gBAAgB,SAAS;AAElC,gBAAI,MAAM;AAEV,gBAAI,EAAE,cAAc,GAAG;AACrB,uBAAS,IAAI;AACb,mBAAK;AAAA,YACP;AAAA,UACF,CAAC,EACA,GAAG,SAAS,SAAU,KAAK;AAC1B,qBAAS,MAAM,GAAG;AAAA,UACpB,CAAC;AAAA,QACL;AAEA,qBAAa,UAAU,QAAQ,WAAW;AAE1C,YAAI,GAAG,uBAAuB,SAAU,WAAW;AACjD;AACA,sBAAY,SAAS;AAAA,QACvB,CAAC;AAID,eAAO,aAAa;AAAA,MACtB,CAAC;AAAA,IACH;AAAA;AAAA;",
  "names": []
}
